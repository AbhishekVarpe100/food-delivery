#!/usr/bin/env node
import D from 'chalk';
import { Command } from 'commander';
import Pt from 'gradient-string';
import pr, { existsSync, readFileSync, mkdirSync, writeFileSync, renameSync } from 'node:fs';
import { exec, execSync } from 'node:child_process';
import io from 'async-retry';
import { compareVersions } from 'compare-versions';
import ao, { oraPromise } from 'ora';
import { fileURLToPath } from 'node:url';
import jo, { resolve, join, basename } from 'pathe';
import Co from 'fast-glob';
import * as F from '@clack/prompts';
import { spinner, text, select, cancel, isCancel } from '@clack/prompts';
import { findUp } from 'find-up';
import ft from '@winches/prompts';
import { Readable } from 'node:stream';
import { pipeline } from 'node:stream/promises';
import Go from 'tar';

var It=["#F54180","#338EF7"],Ze=Pt(...It),Zn=Ze("NextUI CLI:"),s=class{constructor(){}static log(...t){console.log(...t);}static info(...t){console.info(...t.map(n=>D.blue(n)));}static success(...t){console.info(...t.map(n=>D.green(n)));}static warn(...t){console.warn(...t.map(n=>D.yellow(n)));}static error(...t){console.error(...t.map(n=>D.red(n)));}static grey(...t){console.log(...t.map(n=>D.gray(n)));}static gradient(t,n){this.log(Pt(...n?.colors??It)(String(t)));}static prefix(t,...n){return this[t](Zn,...n)}static newLine(t){t||(t=1);for(let n=0;n<t;n++)this.log();}};function eo(e,t){let n=0,o=e.length,r=t.length,i=0,a=0;for(;i<o&&a<r;)e[i]===t[a]&&(n++,a++),i++;return n}function be(e,t){let n=0,o="";for(let r of e){let i=eo(r,t);i>n&&(n=i,o=r);}return o!==""?o:null}function et(e,t){let n=be(e,t);n?s.error(`Unknown option '${t}', Did you mean '${n}'?`):s.error(`Unknown option '${t}'`),process.exit(1);}var tt={bold:{bottomLeft:"\u2517",bottomRight:"\u251B",horizontal:"\u2501",topLeft:"\u250F",topRight:"\u2513",vertical:"\u2503"},classic:{bottomLeft:"+",bottomRight:"+",horizontal:"-",topLeft:"+",topRight:"+",vertical:"|"},double:{bottomLeft:"\u255A",bottomRight:"\u255D",horizontal:"\u2550",topLeft:"\u2554",topRight:"\u2557",vertical:"\u2551"},doubleSingle:{bottomLeft:"\u2558",bottomRight:"\u255B",horizontal:"\u2550",topLeft:"\u2552",topRight:"\u2555",vertical:"\u2502"},round:{bottomLeft:"\u2570",bottomRight:"\u256F",horizontal:"\u2500",topLeft:"\u256D",topRight:"\u256E",vertical:"\u2502"},single:{bottomLeft:"\u2514",bottomRight:"\u2518",horizontal:"\u2500",topLeft:"\u250C",topRight:"\u2510",vertical:"\u2502"},singleDouble:{bottomLeft:"\u2559",bottomRight:"\u255C",horizontal:"\u2500",topLeft:"\u2553",topRight:"\u2556",vertical:"\u2551"}};var V=process.cwd(),I=e=>resolve(V,e),Pe=resolve(fileURLToPath(import.meta.url),"../components.json");function E(e="",t=""){try{return compareVersions(e,t)}catch{return 0}}async function co(){if(!existsSync(Pe)){await St();return}let e=JSON.parse(readFileSync(Pe,"utf-8")),t=e.version,n=e.betaVersion,o=await H("latestVersion"),r=await H("betaVersion");(E(t,o)===-1||E(n,r)===-1)&&await St(o,r);}async function nt(){let e={};await co();try{e=JSON.parse(readFileSync(Pe,"utf-8"));}catch(t){}return e}async function ot(e,t){t=t??`Executing ${e}`;let n=ao({discardStdin:!1,spinner:{frames:[`\u280B ${D.gray(`${t}.`)}`,`\u2819 ${D.gray(`${t}..`)}`,`\u2839 ${D.gray(`${t}...`)}`,`\u2838 ${D.gray(`${t}.`)}`,`\u283C ${D.gray(`${t}..`)}`,`\u2834 ${D.gray(`${t}...`)}`,`\u2826 ${D.gray(`${t}.`)}`,`\u2827 ${D.gray(`${t}..`)}`,`\u2807 ${D.gray(`${t}...`)}`,`\u280F ${D.gray(`${t}.`)}`],interval:150}});n.start();let o=await new Promise(r=>{exec(e,(i,a)=>{i&&(s.error(`Exec cmd ${e} error`),process.exit(1)),r(a.trim());});});return n.stop(),o}async function B(e){return x.nextUIComponentsPackageMap[e]?x.nextUIComponentsPackageMap[e].version:(await Nt(e)).version}var vt=e=>`https://unpkg.com/@nextui-org/react@${e}/dist/components.json`;async function St(e,t){[e,t]=await Promise.all([e||H("latestVersion"),t||H("betaVersion")]);let n=vt(e),[o,r]=await Promise.all([$t(n),L("beta")?$t(vt(t),!1):Promise.resolve([])]),i=r.filter(p=>!o.find(m=>m.name===p.name));o.push(...i);let a={betaComponents:r,betaVersion:t,components:o,version:e};return writeFileSync(Pe,JSON.stringify(a,null,2),"utf-8"),a}async function $t(e,t=!0){let n;return await oraPromise(io(async o=>{try{let r=await fetch(e,{body:null,headers:{"Content-Type":"application/json",accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7"},method:"GET",mode:"cors"});n=JSON.parse(await r.text());}catch(r){o(r);}},{retries:3}),{failText(o){t&&s.prefix("error",`Update components data error: ${o}`),process.exit(1);},...t?{successText:D.greenBright(`Components data updated successfully!
`)}:{},text:"Fetching components data..."}),n}process.env.CI==="true";var Et=resolve(fileURLToPath(import.meta.url),"../.."),rt=e=>resolve(Et,e),Lt=resolve(fileURLToPath(import.meta.url),".."),mo=existsSync(join(Lt,"components.json")),Me=mo?resolve(`${Lt}/.nextui-cli-cache`):resolve(join(Et,".."),"node_modules/.nextui-cli-cache"),Re=resolve(`${Me}/data.json`);var ho=30*6e4,it=!1;function st(e=it){it=!!e,!existsSync(Me)&&(mkdirSync(Me,{recursive:!0}),writeFileSync(Re,JSON.stringify({}),"utf8"));}function Oe(){let e=readFileSync(Re,"utf8");return JSON.parse(e)}function Rt(e,t,n){st();let o=n??Oe(),r=new Date,i=+r+ho;o[e]={...t,date:r,expiredDate:i,expiredFormatDate:new Date(i).toString(),formatDate:r.toString()},writeFileSync(Re,JSON.stringify(o,void 0,2),"utf-8");}function xo(){return +new Date}function yo(e){return xo()-e}function Ot(e,t){if(it)return !0;let o=(t??Oe())[e];return o?.expiredDate?yo(o.expiredDate)>0:!0}async function Nt(e){let t=Oe();if(Ot(e,t)){let r={version:await ot(`npm view ${e} version`,`Fetching ${e} latest version`)};return Rt(e,r,t),r}return t[e]}async function z(e,t){let n=Oe();if(Ot(e,n)){let i={execResult:await ot(e,t)};return Rt(e,i,n),i.execResult}return n[e].execResult}async function _e(e){return await z(`npm view ${e} dist-tags --json`,`Fetching ${e} tags`)}function _t(e){return `@nextui-org/${e.replace("@nextui-org/","")}`}async function Ie(e){if(x.betaNextUIComponentsPackageMap[e])return x.betaNextUIComponentsPackageMap[e].version;let t=await _e(e);try{return JSON.parse(t).beta}catch(n){s.error(`Get beta version error: ${n}`),process.exit(1);}}async function Vt(e){return await Promise.all(e.map(_t).map(async n=>{let o=await Ie(n);return `${_t(n)}@${o}`}))}var Ve=/([\^~])/;function qt(e,t){return s.gradient(e),t}function Yt(e){return e.split("-").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join("")}var Q=(e,t)=>Co.sync(`${e}`,{absolute:!0,cwd:V,deep:5,ignore:["node_modules/**","dist/**","build/**","coverage/**","public/**","out/**"],onlyFiles:!0,...t});function qe(e){return e==="false"?!1:!!e}function Kt(e,t){return Object.fromEntries(Object.entries(e).filter(([n])=>!t.includes(n)))}function ie(e,t){return e=X(e),t=X(t),je(e,t)?je(e,t):Fe(e,t)?Fe(e,t):Ft(e,t)?Ft(e,t):t}function je(e,t){let n=e.split("."),o=t.split(".");return n[0]!==o[0]?D.redBright(o.join(".")):""}function Fe(e,t){let n=e.split("."),o=t.split(".");return n[1]!==o[1]?`${D.white(o[0])}${D.white(".")}${D.cyanBright(o.slice(1).join("."))}`:""}function Ft(e,t){let n=e.split("."),o=t.split(".");return n[2]!==o[2]?`${D.white(o.slice(0,2).join("."))}${D.white(".")}${D.greenBright(o.slice(2).join("."))}`:""}function se(e,t){let n=e[t].replace(Ve,""),o=e[t].match(Ve)?.[1]||"";return {currentVersion:n,versionMode:o}}function ge(e){return {bun:{install:"add",remove:"remove",run:"run"},npm:{install:"install",remove:"uninstall",run:"run"},pnpm:{install:"add",remove:"remove",run:"run"},yarn:{install:"add",remove:"remove",run:"run"}}[e]}function X(e,t=!1){return e.split("||").map(r=>r.trim()).map(r=>r.replace(/^[<=>^~]+\s*/,"").trim()).sort((r,i)=>t?compareVersions(i,r):compareVersions(r,i))[0]}function Z(e,t){let n=e.replace(M,""),o=t-n.length>0?" ".repeat(t-n.length):"";return `${e}${o}`}function T(e){return e.replace(M,"")}function A(e,t=!0){let n;try{n=JSON.parse(readFileSync(e,"utf-8"));}catch(c){s.prefix("error",`Error reading package.json file: ${e} 
Error: ${c}`);}let o=n.devDependencies||{},r=n.dependencies||{},i={...o,...r},a=new Set(Object.keys(i)),p=x.nextUIComponents.map(c=>{let u=c.version,y=c.versionMode;if(a.has(c.package)){let f=se(i,c.package);u=t?`${f.currentVersion} new: ${u}`:f.currentVersion,y=f.versionMode;}return {...c,version:u,versionMode:y}}).filter(c=>a.has(c.package)),m=a.has(b);return {allDependencies:i,allDependenciesKeys:a,currentComponents:p,dependencies:r,devDependencies:o,isAllComponents:m,packageJson:n}}function Bt(e){return e.map(t=>{let o=x.nextUIComponentsMap[t]?.package;return o||t})}async function zt(e,t,n=!0){let o=[];for(let r of e){let{currentVersion:i}=se(t,r),{versionMode:a}=se(t,r),p=(await z(`npm show ${r} homepage`)||"").replace(/\n/,""),m=(await z(`npm show ${r} description`)||"").replace(/\n/,""),c=x.nextUIComponentsPackageMap[r]?.version||await B(r);i=n?`${i} new: ${c}`:i;let u={description:m||"",docs:p||"",name:r,package:r,peerDependencies:{},status:"stable",style:"",version:i,versionMode:a};o.push(u);}return o}var Jt="nextui-cli",Ae="framer-motion",ve="tailwindcss",b="@nextui-org/react",q="@nextui-org/theme",ee="@nextui-org/system";var at="https://nextui.org/docs/guide/installation#global-installation",Ye="https://nextui.org/docs/guide/installation#tailwind-css-setup";var Wt="https://nextui.org/docs/guide/installation#setup-pnpm-optional",Ke="https://nextui.org/docs/guide/installation#provider-setup",S={checkPluginsRegex:/nextui(([\W\w]+)?)/,content:"./node_modules/@nextui-org/theme/dist/**/*.{js,ts,jsx,tsx}",darkMode:'darkMode: "class"',importContent:(e=!1)=>e?"import {nextui} from '@nextui-org/theme';":"const {nextui} = require('@nextui-org/theme');",plugins:"nextui()"},Be={content:(e,t)=>{e.forEach(r=>{let i=Gt(r,t);e.push(...i);});let n=[...new Set(e.map(r=>r.style||r.name))];return n.length===1?`./node_modules/@nextui-org/theme/dist/components/${n[0]}.js`:`./node_modules/@nextui-org/theme/dist/components/(${n.reduce((r,i)=>r+=`${i}|`,"").replace(/\|$/,"")}).js`},plugins:"nextui()"},pt={import:"NextUIProvider"},R={content:"public-hoist-pattern[]=*@nextui-org/*"};function Gt(e,t){let n=e.name,o=I(`node_modules/@nextui-org/${n}`),r=[e];if(!existsSync(o)&&t){let a=I("node_modules/.pnpm"),p=Co.sync(`**/@nextui-org/${n}`,{absolute:!0,cwd:a,onlyDirectories:!0})[0];if(p)o=p;else return r}let{currentComponents:i}=A(join(o,"package.json"));if(i.length)for(let a of i){let p=Gt(a,t);r.push(...p);}return r}var x={debug:!1,beta:!1,cliLatestVersion:"",latestVersion:"",betaVersion:"",betaNextUIComponents:[],betaNextUIComponentsKeys:[],betaNextUIComponentsKeysSet:new Set,betaNextUIComponentsMap:{},betaNextUIComponentsPackageMap:{},betaNextUIcomponentsPackages:[],nextUIComponents:[],nextUIComponentsKeys:[],nextUIComponentsKeysSet:new Set,nextUIComponentsMap:{},nextUIComponentsPackageMap:{},nextUIcomponentsPackages:[]};async function H(e){let t=x[e];return t||(e==="latestVersion"?(t=await B(b),x[e]=t):e==="cliLatestVersion"?(t=await B(Jt),x[e]=t):e==="betaVersion"&&(t=await Ie(b),x[e]=t)),t}function L(e){return x[e]}function Io(e){let t=e.map(a=>a.name),n=e.map(a=>a.package),o=new Set(t),r=e.reduce((a,p)=>(a[p.name]=p,a),{}),i=e.reduce((a,p)=>(a[p.package]=p,a),{});return {nextUIComponentsKeys:t,nextUIComponentsKeysSet:o,nextUIComponentsMap:r,nextUIComponentsPackageMap:i,nextUIcomponentsPackages:n}}function ct({beta:e,nextUIComponents:t}){let{nextUIComponentsKeys:n,nextUIComponentsKeysSet:o,nextUIComponentsMap:r,nextUIComponentsPackageMap:i,nextUIcomponentsPackages:a}=Io(t);e?(x.betaNextUIComponents=t,x.betaNextUIComponentsKeys=n,x.betaNextUIComponentsKeysSet=o,x.betaNextUIComponentsMap=r,x.betaNextUIComponentsPackageMap=i,x.betaNextUIcomponentsPackages=a):(x.nextUIComponents=t,x.nextUIComponentsKeys=n,x.nextUIComponentsKeysSet=o,x.nextUIComponentsMap=r,x.nextUIComponentsPackageMap=i,x.nextUIcomponentsPackages=a);}var ze=["package","version","status","docs"],Ht=["package","version","status"];var M=/\u001b\[[\d;]+m/g,U=tt.round,lt="   ",Se=`${U.vertical}${lt}`,Xt=`${lt}${U.vertical}${lt}`,Qt=/([\W\w]+)\snew:/,Zt=/new:\s([\W\w]+)/;function ae({commandName:e,components:t,message:n=`Current installed components:
`,warnError:o=!0}){if(!t.length){o&&s.prefix("warn","No components found");return}let r={description:0,docs:0,name:0,originVersion:0,package:0,peerDependencies:0,status:0,style:0,version:0};for(let u of t)for(let y in u){let f=String(u[y]);if(y==="version"){let l=f.match(Zt)?.[1],g=f.match(Qt)?.[1],w=T(en(g,l));r[y]=Math.max(r[y],Math.max(w.length,7)),r.originVersion=Math.max(r.originVersion,g.length);continue}r[y]=Math.max(r[y],f.length);}let i=t.reduce((u,y)=>{let f=Se;for(let l of ze){let g=Z(y[l],r[l]);if(e!=="list"&&l==="version"){let w=g.match(Qt)?.[1]?.trim(),C=g.match(Zt)?.[1]?.trim();w===C?(g=g.replace(/\snew:\s[\W\w]+(\s+)?/,""),g=Z(`${Z(g,r.originVersion)} \u{1F680}latest`,r[l]),g=g.replace("latest",D.magentaBright.underline("latest"))):C&&(g=Z(en(Z(w,r.originVersion),C),r[l]));}y.status==="stable"&&Ht.includes(l)?g=D.greenBright(g):y.status==="new"?g=D.magentaBright(g):y.status==="updated"&&(g=D.blueBright(g)),f+=g+Xt;}return u.push(f),u},[]),a=U.topLeft+Se.replace(/.*/g,U.horizontal).slice(1),p=Se,m=U.vertical+Se.replace(/.*/g,U.horizontal).slice(1);for(let u of ze)a+=`${U.horizontal.padEnd(r[u]+7,U.horizontal)}`,p+=D.redBright(Yt(u).padEnd(r[u]))+Xt,m+=`${U.horizontal.padEnd(r[u]+7,U.horizontal)}`;a=a.slice(0,-2)+U.topRight,m=m.slice(0,-2)+U.vertical;let c=U.bottomLeft+Se.replace(/.*/g,U.horizontal).slice(1);for(let u of ze)c+=`${U.horizontal.padEnd(r[u]+7,U.horizontal)}`;c=c.slice(0,-2)+U.bottomRight,i=[a,p,m,...i,c],s.info(n),s.log(i.join(`
`));}function tn(){s.newLine(),s.log(D.redBright("Environment Info:")),s.log(D.blueBright("  System:")),s.log(D.blueBright("    OS:"),process.platform),s.log(D.blueBright("    CPU:"),process.arch),s.log(D.greenBright("  Binaries:")),s.log(D.greenBright("    Node:"),process.version),s.newLine();}function $e({align:e="center",borderStyle:t="round",center:n=!1,color:o,log:r=!0,padding:i=0,text:a,title:p}){let m=tt[t],c=o?Object.fromEntries(Object.entries(m).map(([$,N])=>[$,D[o](N)])):m,u=a.split(`
`),y=u.map($=>$.replace(M,"")),f=i>0,l=i,g=n||f,w=y.reduce(($,N)=>N.length>$?N.length:$,0);w=f?w+l*4:w;let C=p?p.replace(M,""):"",d=p?C.length:0,P=w-d,h=2;for(;d+h+l>=w;)w+=Math.floor(d/2);P=w-d;let k=(()=>{if(p)if(e==="center"){let $=Math.floor(P/2)-1,N=Math.ceil(P/2)-1,Qe=$>0?c.horizontal.repeat($):"",G=N>0?c.horizontal.repeat(N):"";return `${Qe} ${p} ${G}`}else return e==="left"?` ${p} ${c.horizontal.repeat(P-2)}`:`${c.horizontal.repeat(P-2)} ${p} `;return c.horizontal.repeat(w)})(),v=c.topLeft+k+c.topRight,_=c.bottomLeft+c.horizontal.repeat(w)+c.bottomRight,W=u.reduce(($,N)=>{let Qe=N.replace(M,""),G=w-Qe.length,Gn=" ".repeat(G),kt=Math.floor(G/2),bt=Math.ceil(G/2),Hn=kt>0?" ".repeat(kt):"",Xn=bt>0?" ".repeat(bt):"";if(n)$.push(`${c.vertical}${G?`${Hn}${N}${Xn}`:N}${c.vertical}`);else if(i){let Qn=G-l*2;$.push(`${c.vertical}${" ".repeat(l*2)}${N}${" ".repeat(Qn)}${c.vertical}`);}else $.push(`${c.vertical}${G>0?`${N}${Gn}`:N}${c.vertical}`);return $},[]);if(g)for(let $=0;$<l;$++)W.unshift(`${c.vertical}${" ".repeat(w)}${c.vertical}`),W.push(`${c.vertical}${" ".repeat(w)}${c.vertical}`);return W=[v,...W,_],r&&s.log(W.join(`
`)),W.join(`
`)}function en(e,t){return `${D.white(`${e} ->`)} ${D.yellowBright(`${t} (new)`)}`}var Je={name:"nextui-cli",private:!1,type:"module",license:"MIT",version:"0.5.1",homepage:"https://github.com/nextui-org/nextui-cli#readme",description:"A CLI tool that unlocks seamless NextUI integration",keywords:["UI","CLI","Tool","NextUI","Template","Integration","Add Component"],author:{name:"NextUI",email:"support@nextui.org",url:"https://github.com/nextui-org"},repository:{type:"git",url:"https://github.com/nextui-org/nextui-cli.git"},bugs:{url:"https://github.com/nextui-org/nextui-cli/issues"},publishConfig:{access:"public",registry:"https://registry.npmjs.org/"},files:["dist"],bin:{nextui:"./dist/index.js"},main:"./dist/index.js",module:"./dist/index.js",types:"./dist/index.d.ts",scripts:{dev:"tsup --watch","link:cli":"pnpm link --global","link:remove":"pnpm uninstall --global nextui-cli",build:"tsup","update:components":"tsx src/scripts/update/update-components.ts","sync:docs":"tsx src/scripts/sync/sync.ts","clean:cache":"tsx src/scripts/cache/clean.ts",lint:"eslint . --max-warnings=0","lint:fix":"eslint . --max-warnings=0 --fix","check:prettier":"prettier --check .","check:types":"tsc --noEmit",changelog:"npx conventional-changelog -p angular -i CHANGELOG.md -s --commit-path .",release:"bumpp --execute='pnpm run changelog' --all",prepare:"husky install",postbuild:"pnpm run update:components",prepublishOnly:"pnpm run build"},dependencies:{"@clack/prompts":"0.7.0","@winches/prompts":"0.0.6","async-retry":"1.3.3",chalk:"5.3.0",commander:"11.0.0","compare-versions":"6.1.1","fast-glob":"3.3.2","find-up":"7.0.0","gradient-string":"2.0.2",ora:"8.0.1",pathe:"1.1.2",tar:"6.2.1"},devDependencies:{"@commitlint/cli":"17.7.1","@commitlint/config-conventional":"17.7.0","@types/gradient-string":"1.1.3","@types/node":"20.11.30","@typescript-eslint/eslint-plugin":"6.7.2","@typescript-eslint/parser":"6.7.2",bumpp:"9.4.0","clean-package":"2.2.0","commitlint-plugin-function-rules":"2.0.2","conventional-changelog-cli":"4.1.0",eslint:"8.50.0","eslint-config-prettier":"9.0.0","eslint-import-resolver-typescript":"3.6.1","eslint-plugin-import":"2.28.1","eslint-plugin-prettier":"5.0.0","eslint-plugin-sort-destructure-keys":"1.5.0","eslint-plugin-sort-keys-fix":"1.1.2","eslint-plugin-unicorn":"52.0.0","eslint-plugin-unused-imports":"3.0.0",husky:"8.0.3","lint-staged":"14.0.1",prettier:"3.3.2",tsup:"7.2.0",tsx:"4.7.1",typescript:"5.2.2"},engines:{pnpm:">=9.x"},packageManager:"pnpm@9.6.0"};function nn(e){let t=/import {?\s*([\W\w]+?)\s*}? from ["'](.+)["']/g,n=e.match(t)??[],o=[];for(let i of n)o.push(r(i));return o.length?o:[];function r(i){let a=/import {?\s*([\W\w]+?)\s*}? from ["'](.+)["']/,p=i.match(a)??[];return [p[1]??"",p[2]??""]}}function on(e){return e.replace(/^["'`](.*)["'`]$/,"$1")}function Y(e,t){let n=new RegExp(`\\s*${e}:\\s\\[([\\w\\W]*?)\\]\\s*`);return n.test(t)?t.match(n)?.[1]?.split(/,\s/g).map(o=>on(o.trim())).filter(Boolean)??[]:[]}function fe(e,t,n,o){let r=new RegExp(`\\s*${e}:\\s\\[([\\w\\W]*?)\\]\\s*`),i=o??n.map(u=>JSON.stringify(u)).join(", ");if(r.test(t)){let u=e==="content"?`
  ${e}: [${i}]`:`
  ${e}: [${n}]`;return t.replace(r,u)}let a=t.split(`
`),p=a.findIndex(u=>u.includes("content:")),m=a.findIndex(u=>u.includes("module.exports =")),c=p!==-1?p-1:m!==-1?m:0;return e==="content"?a.splice(c+1,0,`  ${e}: [${i}],`):a.splice(c+1,0,`  ${e}: [${n.map(u=>on(u))}],`),a.join(`
`)}var de="".padEnd(7),sn="Missing";async function an(e){let{all:t,allDependencies:n,isNextUIAll:o,upgradeOptionList:r}=e,i=[],a=new Set,p=await So(t,o,n,a),m=r.map(l=>({...l,latestVersion:ie(l.version,l.latestVersion)})),c=await Promise.all(r.map(l=>Ue(l.package,n,a,l.peerDependencies))),u=await $o([...a]),y=[...m,...p.allOutputList],f=[...c.flat(),...p.allPeerDepList,...u].filter((l,g,w)=>g===w.findIndex(C=>C.package===l.package));return vo(y,f),i=[...y,...f].filter((l,g,w)=>!l.isLatest&&g===w.findIndex(C=>C.package===l.package)),Uo(i),i}function rn(e,t=!1){if(!e.length)return "";let n=[],o={latestVersion:0,package:0,version:0};for(let r of e)for(let i in r){if(!Object.prototype.hasOwnProperty.call(r,i)||!r[i])continue;i==="version"&&(r[i]=r[i].replace(Ve,""));let a=i==="version"?r[i].replace(M,"").length:r[i].length;o[i]=Math.max(o[i],a);}for(let r of e){if(r.isLatest){if(t)continue;n.push(`  ${D.white(`${`${r.package}@${r.versionMode||""}${r.latestVersion}`.padEnd(o.package+de.length+de.length)}`)}${D.greenBright("latest").padStart(o.version)}${de}`);continue}n.push(`  ${D.white(`${r.package.padEnd(o.package+de.length)}${de}${Z(`${r.versionMode||""}${r.version}`,o.version)}  ->  ${r.versionMode||""}${r.latestVersion}`)}${de}`);}return n.join(`
`)}async function Ue(e,t,n,o){if(o=o||JSON.parse(await z(`npm show ${e} peerDependencies --json`))||{},!o||!Object.keys(o).length)return [];let r=[];for(let[i,a]of Object.entries(o)){if(r.some(y=>y.package===i))continue;let p=t[i],m=X(a);if(!p){n.add({name:i,version:m});continue}let{versionMode:c}=se(t,i),u=E(p,m)>=0;u?m=X(p):m=await B(i),r.push({isLatest:u,latestVersion:u?m:ie(p,m),package:i,version:p,versionMode:c});}return r}function vo(e,t){let n=e.length===1?"Component":"Components",o={components:{color:"blue",text:"",title:D.blue(n)},peerDependencies:{color:"yellow",text:"",title:D.yellow("PeerDependencies")}},r=rn(e),i=rn(t,!0),a=t.filter(p=>!p.isLatest);r.length&&$e({...o.components,text:r}),s.newLine(),a.length&&s.log(D.gray(`Required min version: ${a.map(p=>`${p.package}>=${p.latestVersion.replace(M,"")}`).join(", ")}`)),i.length&&$e({...o.peerDependencies,text:i});}async function So(e,t,n,o){if(!e||!t)return {allOutputList:[],allPeerDepList:[]};let r=x.latestVersion,{currentVersion:i,versionMode:a}=se(n,b),p=ie(i,r),m=E(i,r)>=0,c=await Ue(b,n,o),u=await Ue(q,n,o),y=[{isLatest:m,latestVersion:p,package:b,version:i,versionMode:a}],f=[...c,...u];return {allOutputList:y,allPeerDepList:f}}async function $o(e){let t=[];for(let n of e){let o={isLatest:!1,latestVersion:n.version,package:n.name,version:D.red(sn),versionMode:""};t.push(o);}return t}function Uo(e){let t={major:0,minor:0,patch:0};for(let o of e){if(o.version===sn){t.major++;continue}let r=T(o.latestVersion);je(o.version,r)?t.major++:Fe(o.version,r)?t.minor++:t.patch++;}let n=Object.entries(t).reduce((o,[r,i])=>i?`${o}${D.yellowBright(i)} ${r}, `:o,"").replace(/, $/,"");return n&&(s.log(n),s.newLine()),t}function pn({dependencies:e,devDependencies:t,upgradePackageList:n}){for(let o of n){let r=T(o.latestVersion);if(t[o.package]){t[o.package]=r;continue}e[o.package]=r;}}function pe(e,t){let{errorInfo:n,missingDependencies:o,tailwindName:r}=t;return e==="missingDependencies"?{level:"error",name:"missingDependencies",outputFn:()=>{s.log("You have not installed the required dependencies"),s.newLine(),s.log("The required dependencies are:"),o.forEach(i=>{s.log(`- ${i}`);}),s.newLine(),s.log(`See more info here: ${D.underline(at)}`);}}:e==="incorrectTailwind"?{level:"error",name:"incorrectTailwind",outputFn:()=>{s.log(`Your ${r} is incorrect`),s.newLine(),s.log("The missing part is:"),n.forEach(i=>{s.log(`- need to add ${i}`);}),s.newLine(),s.log(`See more info here: ${D.underline(`${Ye}-1`)}`);}}:{level:"error",name:"incorrectApp",outputFn:()=>{s.log("Your App.tsx is incorrect"),s.newLine(),s.log("The missing part is:"),n.forEach(i=>{s.log(`- need to add ${i}`);}),s.newLine(),s.log(`See more info here: ${D.underline(at)}`);}}}async function ce(e,t,n){let o=[],{allDependencies:r,beta:i,packageNames:a,peerDependencies:p}=n??{},m=[];if(p){let c=await No({allDependencies:r,packageNames:a});m.push(...c);}if(e==="all"){let c=t.has(b),u=t.has(Ae),y=t.has(ve);if(c&&u&&!m.length)return [!0];!c&&o.push(i?`${b}@${x.betaVersion}`:b),!u&&o.push(Ae),!y&&o.push(ve);}else if(e==="partial"){let c=t.has(Ae),u=t.has(ve),y=t.has(ee),f=t.has(q);if(c&&y&&f&&!m.length)return [!0];!c&&o.push(Ae);let l=await _e(ee),g=await _e(q);!y&&o.push(i?`${ee}@${l}`:ee),!f&&o.push(i?`${q}@${g}`:q),!u&&o.push(ve);}return [!1,...o,...p?m:[]]}async function No(e){let{allDependencies:t,packageNames:n}=e,o=[];for(let r of n){let i=await Ue(r,t,new Set);for(let a of i)if(!a.isLatest){let p=o.findIndex(u=>u.includes(a.package)),c=T(o[p]||"")?.match(/@([\d.]+)/)?.[1];c&&E(c,T(a.latestVersion))<=0&&o.splice(p,1),o.push(`${a.package}@${a.latestVersion}`);}}return o}function le(e,t,n,o,r,i){if(e==="partial"&&!n.length)return [!0];let a=[],p=r??readFileSync(t,"utf-8"),m=Y("content",p),c=Y("plugins",p);if(e==="all"){let y=Y("darkMode",p).some(g=>g.includes("class"))||/darkMode:\s*["'`]class/.test(p),f=m.some(g=>g.includes(S.content)),l=c.some(g=>S.checkPluginsRegex.test(g));if(y&&f&&l)return [!0];!y&&a.push(S.darkMode),!f&&a.push(S.content),!l&&a.push(S.plugins);}else if(e==="partial"){let u=Be.content(n,o),y=!1,f=m.some(g=>g.includes(S.content)?(y=!0,!0):g.includes(u));i&&y&&s.log(`
${D.yellow("Attention")} Individual components from NextUI do not require the "${D.bold(S.content)}" in the tailwind config
For optimized bundle sizes, consider using "${D.bold(u)}" instead`);let l=c.some(g=>S.checkPluginsRegex.test(g));if(f&&l)return [!0];!f&&a.push(u),!l&&a.push(S.plugins);}return [!1,...a]}function Ne(e,t){let n=[];if(e==="all"||e==="partial"){let o=readFileSync(t,"utf-8"),i=nn(o).some(([a])=>a.includes(pt.import));if(i)return [!0];!i&&n.push(pt.import);}return [!1,...n]}function he(e){let t=[],n;if(e){try{n=readFileSync(e,"utf-8");let o=n.includes(R.content);if(o)return [!0];!o&&t.push(R.content);}catch(o){t.push(`Error reading .npmrc file: ${e} 
Error: ${o}`);}return [!1,...t]}return [!1,...t]}async function xe(e=[],t=!0){let n=[];for(let o of e)if(!x.nextUIComponentsKeysSet.has(o)){let r=be(x.nextUIComponentsKeys,o);n.push([o,r]);}if(n.length){let[o,r]=n.reduce((i,[a,p])=>[i[0]+D.underline(a)+", ",i[1]+(p?D.underline(p)+", ":"")],["",""]);return t&&s.prefix("error",`Illegal components: ${o.replace(/, $/,"")}${r?`
${"".padEnd(12)}It may be a typo, did you mean ${r.replace(/, $/,"")}?`:""}`),!1}return !0}var ut=new Map;async function oe(e,t){return new Promise((n,o)=>{try{let{cache:r=!0,logCmd:i=!0}=t||{};ut.has(e)&&r&&n(ut.get(e)),i&&(s.newLine(),s.log(`${e}`));let a=execSync(e,{stdio:"inherit",...t?Kt(t,["logCmd"]):{}});if(a){let p=a.toString();n(p),ut.set(e,p);}n("");}catch(r){o(r);}})}var mn=e=>{isCancel(e)&&(cancel(`${D.red("\u2716")} Operation cancelled`),process.exit(0));},un=async e=>{let t=await text(e);return mn(t),t},Te=async e=>{let t=await select(e);return mn(t),t},cn=spinner(),gn=async e=>{let{failText:t,successText:n,task:o,text:r}=e,i=null;try{cn.start(r),i=await o,cn.stop(n);}catch{cancel(t??i??"Task failed"),process.exit(0);}return i};async function We(e){try{await e();}catch(t){t&&(await Te({message:`${D.red("Error: ")}a unexpected error occurred, run "pnpm install" maybe can fix it or report it as a bug`,options:[{label:"Re-run pnpm install",value:"re-run-pnpm-install"},{label:"Exit",value:"exit"}]})==="exit"&&process.exit(1),await oe("pnpm install --force"),await e());}}async function gt(e,t=[]){if(L("debug"))for(let n of t)s.warn(`Debug: ${n}`);else await We(()=>oe(e));}function dn(e,t){if(!e.length||!L("debug"))return;let{dependencies:n,packageJson:o}=A(t);for(let r of e){let i=x.nextUIComponentsMap[r];i&&(n[i.package]=`${i.package}@${i.version}`);}writeFileSync(t,JSON.stringify({...o,dependencies:n},null,2));}function hn(e,t){if(!e.length||!L("debug"))return;let{dependencies:n,packageJson:o}=A(t);for(let r of e){let i=x.nextUIComponentsMap[r];i&&delete n[i.package];}writeFileSync(t,JSON.stringify({...o,dependencies:n},null,2));}var dt={onCancel:()=>{s.log(`${D.red("\u2716")} Operation cancelled`),process.exit(0);}};async function ye(e,t){return (await ft({hint:"- Space to select. Return to submit",message:e,min:1,name:"value",type:"autocompleteMultiselect",...t?{choices:t}:{}},dt)).value}async function me(e,t){return (await ft({message:e,name:"value",type:"select",...t?{choices:t}:{}},dt)).value}async function xn(e,t){return (await ft({hint:"- Space to select. Return to submit",message:e,min:1,name:"value",type:"multiselect",...t?{choices:t}:{}},dt)).value}var Ge=["npm","bun","pnpm","yarn"];var yn={"bun.lockb":"bun","npm-shrinkwrap.json":"npm","package-lock.json":"npm","pnpm-lock.yaml":"pnpm","yarn.lock":"yarn"};async function J(e=V){let t,n=await findUp(Object.keys(yn),{cwd:e});return n?t=yn[jo.basename(n)]:t=await me("No agent found, please choose one",Ge.map(o=>({title:o,value:o}))),t}function Cn(e,t){let{format:n=!1,write:o=!0}=t,r=readFileSync(e,"utf-8");r=`import {NextUIProvider} from "@nextui-org/react";
${r}`,r=qo(r),o&&writeFileSync(e,r,"utf-8"),n&&execSync(`npx prettier --write ${e}`,{stdio:"ignore"});}function qo(e){let t=/return\s*\(([\S\s]*?)\);/g;return e.replace(t,(o,r)=>`return (
      <NextUIProvider>
        ${r.trim()}
      </NextUIProvider>
    );`)}function Xe(e,t){let{errorInfoList:n,format:o=!1,tailwindPath:r,write:i=!0}=t;if(!n.length)return;let a=readFileSync(r,"utf-8"),p=Y("content",a),m=Y("plugins",a);for(let c of n){let[u,y]=Yo(c);if(u==="content"){if(p.includes(S.content))continue;p=p.filter(l=>!l.includes("@nextui-org/theme/dist/")),p.push(y),a=fe("content",a,p,p.map((l,g,w)=>g===0?w.length===1?`
    ${JSON.stringify(l)}
`:`
    ${JSON.stringify(l)}`:w.length-1===g?`    ${JSON.stringify(l)}
  `:`    ${JSON.stringify(l)}`).join(`,
`));}else u==="plugins"&&(m.push(y),a=fe("plugins",a,m),a=`${S.importContent(r.endsWith(".ts"))}
${a}`);if(e==="all"&&u==="darkMode"){let f=a.indexOf("plugins")-1,l=S.darkMode;a=`${a.slice(0,f)} ${l},
${a.slice(f)}`;}}if(i&&writeFileSync(r,a,"utf-8"),o)try{execSync(`npx prettier --write ${r}`,{stdio:"ignore"});}catch{s.warn(`Prettier failed to format ${r}`);}}function Yo(e){return S.darkMode.includes(e)?["darkMode",e]:S.plugins.includes(e)?["plugins",e]:["content",e]}function Ce(e,t=!0,n=!0,o=void 0){if(!existsSync(e))t&&writeFileSync(e,R.content,"utf-8");else {let r=readFileSync(e,"utf-8");r=`${R.content}
${r}`,t&&writeFileSync(e,r,"utf-8");}if(!o){s.newLine(),s.log(`Added the required content in file: ${e}`),n&&!L("debug")&&(s.newLine(),s.log("Pnpm restructure will be run now"),execSync("pnpm install",{stdio:"inherit"}));return}o({message:`Added the required content in file: ${e}`,runInstall:n});}var wn="https://codeload.github.com/nextui-org/next-app-template/tar.gz/main",kn="https://codeload.github.com/nextui-org/next-pages-template/tar.gz/main",bn="https://codeload.github.com/nextui-org/vite-template/tar.gz/main",Pn="next-app-template-main",In="next-pages-template-main",An="vite-template-main",vn="next-app-template",Sn="next-pages-template",$n="vite-template";function Un(e,t){return e==="all"?`// tailwind.config.js
const {nextui} = require("@nextui-org/react");

/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    "./node_modules/@nextui-org/theme/dist/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  darkMode: "class",
  plugins: [nextui()],
};`:`// tailwind.config.js
const {nextui} = require("@nextui-org/theme");

/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    ${JSON.stringify(t)},
  ],
  theme: {
    extend: {},
  },
  darkMode: "class",
  plugins: [nextui()],
};`}async function Dn(e,t){let{addApp:n=!1,all:o=!1,appPath:r=Q("**/App.(j|t)sx")[0],beta:i=!1,packagePath:a=I("package.json"),tailwindPath:p=Q("**/tailwind.config.(j|t)s")[0]}=t;var{allDependencies:m,allDependenciesKeys:w,currentComponents:C}=A(a);let c=t.prettier??w.has("prettier"),u=!!m[b];if(!e.length&&!o){let h=x.nextUIComponents.filter(k=>!C.some(v=>v.name===k.name));h.length||(s.success("\u2705 All components have been added"),process.exit(0)),e=await ye("Which components would you like to add?",h.map(k=>({description:k.description,title:k.name,value:k.name})));}else o&&(e=[b]);if(!o&&!xe(e,!0))return;var{allDependenciesKeys:w,currentComponents:C}=A(a);let y=C.map(h=>h.name),f=e.filter(h=>y.includes(h)||u&&h===b);if(f.length&&!L("debug")){s.prefix("error",`\u274C You have already added the following components: ${f.map(h=>D.underline(h)).join(", ")}`);return}if(n&&!r){s.prefix("error","\u274C App.(j|t)sx file not found. Please specify the appPath if the default search path does not locate your file.  'add --appPath=yourAppPath'");return}let l=await J(),g=l==="npm"?"install":"add";if(o){let[,...h]=await ce("all",w,{allDependencies:m,beta:i,packageNames:[b],peerDependencies:!0});h=h.map(k=>T(k)),h.length&&(s.info(`Adding required dependencies: ${[...h].map(k=>D.underline(k)).join(", ")}`),await gt(`${l} ${g} ${[...h].join(" ")}`,h));}else {let h=i?await Vt(e):e.map(_=>x.nextUIComponentsMap[_].package),[,...k]=await ce("partial",w,{allDependencies:m,beta:i,packageNames:h,peerDependencies:!0}),v=[...k,...h].map(_=>T(_));s.info(`Adding required dependencies: ${[...v].map(_=>D.underline(_)).join(", ")}`),await gt(`${l} ${g} ${[...v].join(" ")}`,v);}L("debug")&&dn(e,a);var{allDependenciesKeys:w,currentComponents:C}=A(a);let d=o?"all":"partial",P=l==="pnpm";if(p){let[,...h]=le(d,p,C,P,void 0,!0);Xe(d,{errorInfoList:h,format:c,tailwindPath:p}),s.newLine(),s.log(`Tailwind CSS settings have been updated in: ${p}`);}else {let h=Be.content(C,P),k=Un(d,h),v=I("tailwind.config.js");writeFileSync(v,k,"utf-8"),s.newLine(),s.info(`Tailwind CSS configuration file created at: ${v}`);}if(n&&r&&existsSync(r)){let[h]=Ne(d,r);h||(Cn(r,{format:c}),s.newLine(),s.info(`NextUIProvider successfully added to the App file at: ${r}`),s.warn("Please check the placement of NextUIProvider in the App file to ensure it's correctly integrated.'"));}if(l==="pnpm"){let h=I(".npmrc");if(!existsSync(h))writeFileSync(I(".npmrc"),R.content,"utf-8");else {let[k]=he(h);k||Ce(h);}}s.newLine(),s.success("\u2705 Components added successfully"),(w.has(b)||o)&&C.length&&(s.newLine(),s.log(`${D.yellow("Attention")} Individual components from NextUI do not require the \`@nextui-org/react\` package. For optimized bundle sizes, consider using individual components.`),s.log("The redundant dependencies are:"),[...new Set(C)].forEach(h=>{s.log(`- ${h.package}`);})),s.newLine(),s.grey(`Please check the ${D.bold("NextUIProvider")} whether in the correct place (ignore if added)
See more info here: ${Ke}`),L("debug")&&hn(e,a),process.exit(0);}async function Ln(e){let{appPath:t=Q("**/App.(j|t)sx")[0],checkApp:n=!1,checkPnpm:o=!0,checkTailwind:r=!0,packagePath:i=I("package.json"),tailwindPath:a=Q("**/tailwind.config.(j|t)s")}=e,p=qe(n),m=qe(o),c=qe(r),u=[a].flat(),{allDependencies:y,allDependenciesKeys:f,currentComponents:l,isAllComponents:g}=A(i);if(!l.length&&!g){s.prefix("error",`\u274C No ${D.underline("NextUI components")} found in your project. Please consult the installation guide at: https://nextui.org/docs/guide/installation#global-installation`);return}let w=[];if(g&&l.length&&w.push({level:"warn",name:"redundantDependencies",outputFn:()=>{s.log("You have installed some unnecessary dependencies. Consider removing them for optimal performance."),s.newLine(),s.log("The following dependencies are redundant:"),l.forEach(C=>{s.log(`- ${C.package}`);});}}),c&&!u.length&&w.push({level:"error",name:"missingTailwind",outputFn:()=>{s.log("Missing tailwind.config.(j|t)s file. To set up, visit: "+D.underline(Ye));}}),p&&!t&&w.push({level:"error",name:"missingApp",outputFn:()=>{s.log("App.(j|t)sx file not found. Please specify the path using: doctor --appPath=[yourAppPath]");}}),g){let[C,...d]=await ce("all",f,{allDependencies:y,packageNames:[b],peerDependencies:!0});if(l.length){let[P,...h]=await ce("partial",f,{allDependencies:y,packageNames:l.map(k=>k.package),peerDependencies:!0});C=P||C,d=[...h,...d].filter((k,v,_)=>(k=T(k).replace(/@[\d.]+/g,""),_.findIndex(W=>T(W).replace(/@[\d.]+/g,"")===k)===v));}if(C||w.push(pe("missingDependencies",{missingDependencies:d})),c)for(let P of u){let[h,...k]=le("all",P);if(!h){let v=basename(P);w.push(pe("incorrectTailwind",{errorInfo:k,tailwindName:v}));}}if(p&&t){let[P,...h]=Ne("all",t);P||w.push(pe("incorrectApp",{errorInfo:h}));}}else if(l.length){let[C,...d]=await ce("partial",f,{allDependencies:y,packageNames:l.map(P=>P.package),peerDependencies:!0});if(C||w.push(pe("missingDependencies",{missingDependencies:d})),c){let P=await J()==="pnpm";for(let h of u){let[k,...v]=le("partial",h,l,P,void 0,!0);if(!k){let _=basename(h);w.push(pe("incorrectTailwind",{errorInfo:v,tailwindName:_}));}}}if(p&&t){let[P,...h]=Ne("partial",t);P||w.push(pe("incorrectApp",{errorInfo:h}));}}if(m&&await J()==="pnpm"){let d=I(".npmrc"),[P,...h]=he(d);P||w.push({level:"error",name:"incorrectPnpm",outputFn:()=>{s.log(`The pnpm setup is incorrect 
Please update your configuration according to the guidelines provided at: `+D.underline(Wt)),s.newLine(),s.log("Required changes:"),h.forEach(k=>{s.log(`- Add ${k}`);});}});}if(!w.length){s.newLine(),s.success("\u2705 Your project has no detected issues.");return}s.prefix("error",`\u274C Your project has ${D.underline(w.length)} issue${w.length===1?"":"s"} that require attention`),s.newLine();for(let C=0;C<w.length;C++){let d=w[C];s[d.level](`\u2757\uFE0FIssue ${C+1}: ${D.bold(d.name)}`),s.newLine(),d.outputFn(),s.newLine();}process.exit(0);}async function Mn(e){let{packagePath:t=I("package.json")}=e,{currentComponents:n}=A(t);ae({components:n}),tn(),process.exit(0);}var Bo="package-lock=true";function Rn(e){writeFileSync(e,Bo,"utf-8");}async function Ho(e){let t=await fetch(e);if(!t.body)throw new Error(`Failed to download: ${e}`);return Readable.fromWeb(t.body)}async function On(e,t){await io(async n=>{try{await pipeline(await Ho(t),Go.x({cwd:e}));}catch(o){n(new Error(`Failed to download ${t} Error: ${o}`));}},{retries:3});}function _n(e,t){e&&(Object.keys(Le).includes(e)||et(Object.keys(Le),e)),t&&(Ge.includes(t)||et(Ge,t));}var Le={app:vn,pages:Sn,vite:$n};async function jn(e,t){let{package:n="npm",template:o}=t;_n(o,n),F.intro(D.cyanBright("Create a new project"));let{packageName:r,projectName:i,template:a}=await Zo(n,e,o),{run:p}=ge(r);existsSync(rt(`${V}/${i}`))&&(F.cancel(`The project name ${D.redBright(i)} already exists`),process.exit(1)),a==="app"?(await yt(wn),Ct(Pn,i)):a==="pages"?(await yt(kn),Ct(In,i)):a==="vite"&&(await yt(bn),Ct(An,i));let m=rt(`${V}/${i}/.npmrc`);Rn(m),r==="pnpm"&&Ce(m,!0,!1,({message:c})=>{F.log.message(c);}),F.note(`cd ${D.cyanBright(i)}
${D.cyanBright(r)} install`,"Next steps"),F.outro(`\u{1F680} Get started with ${D.cyanBright(`${r} ${p} dev`)}`),process.exit(0);}async function yt(e){await gn({failText:"Template creation failed",successText:"Template created successfully!",task:On(V,e),text:"Creating template..."});}function Ct(e,t){try{renameSync(join(V,e),join(V,t));}catch(n){n&&(F.cancel(`rename Error: ${n}`),process.exit(0));}}async function Zo(e,t,n){let o=[{hint:"A Next.js 14 with app directory template pre-configured with NextUI (v2) and Tailwind CSS.",label:D.gray("App"),value:"app"},{hint:"A Next.js 14 with pages directory template pre-configured with NextUI (v2) and Tailwind CSS.",label:D.gray("Pages"),value:"pages"},{hint:"A Vite template pre-configured with NextUI (v2) and Tailwind CSS.",label:D.gray("Vite"),value:"vite"}];return n=await Te({initialValue:n,message:"Select a template (Enter to select)",options:o}),t=await un({initialValue:t??Le[n],message:"New project name (Enter to skip with default name)",placeholder:t??Le[n]}),e=await Te({initialValue:e,message:"Select a package manager (Enter to select)",options:[{label:D.gray("npm"),value:"npm"},{label:D.gray("yarn"),value:"yarn"},{label:D.gray("pnpm"),value:"pnpm"},{label:D.gray("bun"),value:"bun"}]}),{packageName:e,projectName:t,template:n}}async function Fn(e){let{packagePath:t=I("package.json"),remote:n=!1}=e,o=x.nextUIComponents;try{if(!n){let{currentComponents:r}=await A(t);o=r;}if(!o.length){s.warn(`No NextUI components detected in the specified package.json at: ${t}`);return}n?ae({commandName:"list",components:o}):ae({components:o});}catch(r){s.prefix("error",`An error occurred while attempting to list the components: ${r}`);}process.exit(0);}async function qn(e,t){let{remove:n}=ge(t);await oe(`${t} ${n} ${e.join(" ")}`);}async function Yn(e,t){let{currentComponents:n,isNextUIAll:o,isPnpm:r,prettier:i,tailwindPath:a}=t;if(a&&!existsSync(a)){s.prefix("warn","No tailwind.config.(j|t)s found remove action skipped");return}let p=readFileSync(a,"utf-8"),m=Y("content",p),c=Y("plugins",p),u=m.some(f=>f.includes(S.content));if(!n.length&&!o){let f=c.findIndex(l=>l.includes("nextui"));f!==-1&&c.splice(f,1),p=fe("plugins",p,c),p=p.replace(/(const|var|let|import)[\W\w]+?nextui.*?;\n/,"");}if(!u){for(;m.some(f=>f.includes("nextui"));)m.splice(m.findIndex(f=>f.includes("nextui")),1);p=fe("content",p,m);}writeFileSync(a,p,"utf-8");let[,...y]=le(e,a,n,r,void 0,!0);Xe(e,{errorInfoList:y,format:i,tailwindPath:a}),s.newLine(),s.info(`Remove the removed components tailwind content in file: ${a}`);}async function Bn(e,t){let{all:n=!1,packagePath:o=I("package.json"),tailwindPath:r=Q("**/tailwind.config.(j|t)s")[0]}=t;var{allDependencies:l,allDependenciesKeys:i,currentComponents:g}=A(o);let a=await J(),p=t.prettier??i.has("prettier"),m=!!l[b];if(!g.length&&!m){s.prefix("error",`No NextUI components detected in your package.json at: ${o}`);return}if(n||m)e=m?[b]:g.map(C=>C.package);else if(!e.length)e=await ye("Select the components to remove",g.map(C=>({title:C.package,value:C.package})));else {if(!xe(e))return;e=Bt(e);}let c=e.includes(b)?await zt(e,l):g.filter(C=>e.some(d=>d.includes(C.package)||d.includes(C.name)));ae({components:c,message:D.yellowBright("\u2757\uFE0F Components slated for removal:")}),await me("Confirm removal of these components:",[{title:"Yes",value:!0},{title:"No",value:!1}])||process.exit(0);let y=[...e];g.filter(C=>!e.includes(C.package)).length||(l[q]&&y.push(q),l[ee]&&y.push(ee)),await qn(y,a);var{allDependencies:l,currentComponents:g}=A(o,!1);if(m=!!l[b],Yn(m?"all":"partial",{currentComponents:g,isNextUIAll:m,isPnpm:a==="pnpm",prettier:p,tailwindPath:r}),!g.length&&!m){if(a==="pnpm"){let C=I(".npmrc");if(existsSync(C)){let d=readFileSync(C,"utf-8");d=d.replace(R.content,""),s.newLine(),s.info("Removing specified .npmrc file content"),writeFileSync(C,d,"utf-8");}}s.newLine(),s.warn(`No NextUI components remain installed. Ensure the NextUIProvider is also removed if necessary.
For more information, visit: ${Ke}`);}s.newLine(),s.success(`\u2705 Successfully removed the specified NextUI components: ${e.map(C=>D.underline(C)).join(", ")}`),process.exit(0);}async function zn(e){if(e==="pnpm"){let t=I(".npmrc");if(!existsSync(t))writeFileSync(I(".npmrc"),R.content,"utf-8");else {let[n]=he(t);n||Ce(t);}}}function Jn(e,t,n){let o=e.match(/(^\w+$)/)?.[1];if(o)return t.includes(o);let r=E(e,t);return n&&r===1&&!e.includes("beta")?!1:r>=0}async function Wn(e,t){let{all:n=!1,beta:o=!1,packagePath:r=I("package.json"),write:i=!1}=t,{allDependencies:a,currentComponents:p,dependencies:m,devDependencies:c,packageJson:u}=A(r,!1),y=!!a[b],f=[];if(await Promise.all(p.map(async d=>{let P=x.nextUIComponentsMap[d.name]?.version||await B(d.package),h=o?await Ie(d.package):P,k=Jn(d.version,h,o);f.push({...d,isLatest:k,latestVersion:h});})),!f.length&&!y){s.prefix("error",`No NextUI components detected in your package.json at: ${r}`);return}if(n)e=p.map(d=>d.package);else if(e.length){if(!xe(e))return}else {if(y){let d={isLatest:E(x.latestVersion,X(a[b]))<=0,latestVersion:x.latestVersion,package:b,version:X(a[b])};f.push(d);}f.every(d=>d.isLatest)&&(s.success("\u2705 All NextUI packages are up to date"),process.exit(0)),e=await ye("Select the components to upgrade",f.map(d=>{let P=Jn(d.version,d.latestVersion,o);return {disabled:P,disabledMessage:"Already up to date",title:`${d.package}${P?"":`@${d.version} -> ${ie(d.version,d.latestVersion)}`}`,value:d.package}}));}e=e.map(d=>x.nextUIComponentsMap[d]?.package?x.nextUIComponentsMap[d].package:d);let l=f.filter(d=>e.includes(d.package)),g=await an({all:n,allDependencies:a,isNextUIAll:y,upgradeOptionList:l}),w=[],C=await J();if(g.length){let d=await me("Would you like to proceed with the upgrade?",[{title:"Yes",value:!0},{description:"Select this if you wish to exclude certain packages from the upgrade",title:"No",value:!1}]),{install:P}=ge(C);d||await me("Would you like to exclude any packages from the upgrade?",[{description:"Select this to choose packages to exclude",title:"Yes",value:!0},{description:"Select this to proceed without excluding any packages",title:"No",value:!1}])&&(w=await xn("Select the packages you want to exclude from the upgrade:",g.map(k=>({description:`${k.version} -> ${ie(k.version,k.latestVersion)}`,title:k.package,value:k.package})))),g=g.filter(h=>!w.some(k=>h.package===k)),i?(pn({dependencies:m,devDependencies:c,upgradePackageList:g}),pr.writeFileSync(r,JSON.stringify(u,null,2)),s.newLine(),s.success("\u2705 Upgrade version written to package.json"),process.exit(0)):await We(()=>oe(`${C} ${P} ${g.reduce((h,k,v)=>`${h}${v===0?"":" "}${k.package}@${k.latestVersion.replace(M,"")}`,"")}`));}zn(C),s.newLine(),s.success("\u2705 Upgrade complete. All components are up to date."),process.exit(0);}var wt=["add","env","init","list","upgrade","doctor","remove"],K=new Command;K.name("nextui").usage("[command]").description(qt(`
NextUI CLI v${Je.version}
`,"")).version(Je.version,"-v, --version","Output the current version").helpOption("-h, --help","Display help for command").allowUnknownOption().option("--no-cache","Disable cache, by default data will be cached for 30m after the first request").option("-d, --debug","Debug mode will not install dependencies").action(async(e,t)=>{let n=!1;if(t){let o=t.args?.[0];if(o&&!wt.includes(o)){n=!0;let r=be(wt,o);r?s.error(`Unknown command '${o}', Did you mean '${D.underline(r)}'?`):s.error(`Unknown command '${o}'`);}}if(!n){let r=(await z("nextui --help")).split(`
`);r=r.filter(i=>i&&!i.includes("NextUI CLI v")),r=r.map(i=>{let a=i.match(/(\w+)\s\[/)?.[1];return a?i.replace(a,D.cyan(a)):i}),s.log(r.join(`
`));}process.exit(0);});K.command("init").description("Initializes a new project").argument("[projectName]","Name of the project to initialize").option("-t --template [string]","Specify a template for the new project, e.g., app, pages").option("-p --package [string]","The package manager to use for the new project","npm").action(jn);K.command("add").description("Adds components to your project").argument("[components...]","Names of components to add").option("-a --all [boolean]","Add all components",!1).option("-p --packagePath [string]","Specify the path to the package.json file").option("-tw --tailwindPath [string]","Specify the path to the tailwind.config.js file").option("-app --appPath [string]","Specify the path to the App.tsx file").option("--prettier [boolean]","Apply Prettier formatting to the added content").option("--addApp [boolean]","Include App.tsx file content that requires a provider",!1).option("-b --beta [boolean]","Add beta components",!1).action(Dn);K.command("upgrade").description("Upgrades project components to the latest versions").argument("[components...]","Names of components to upgrade").option("-p --packagePath [string]","Specify the path to the package.json file").option("-a --all [boolean]","Upgrade all components",!1).option("-w --write [boolean]","Write the upgrade version to package.json file",!1).option("-b --beta [boolean]","Upgrade beta components",!1).action(Wn);K.command("remove").description("Removes components from the project").argument("[components...]","Names of components to remove").option("-p --packagePath [string]","Specify the path to the package.json file").option("-a --all [boolean]","Remove all components",!1).option("-tw --tailwindPath [string]","Specify the path to the tailwind.config.js file").option("--prettier [boolean]","Apply Prettier formatting to the added content").action(Bn);K.command("list").description("Lists all components, showing status, descriptions, and versions").option("-p --packagePath [string]","Specify the path to the package.json file").option("-r --remote","List all components available remotely").action(Fn);K.command("env").description("Displays debugging information for the local environment").option("-p --packagePath [string]","Specify the path to the package.json file").action(Mn);K.command("doctor").description("Checks for issues in the project").option("-p --packagePath [string]","Specify the path to the package.json file").option("-tw --tailwindPath [string]","Specify the path to the tailwind.config.js file").option("-app --appPath [string]","Specify the path to the App.tsx file").option("-ca --checkApp [boolean]","Check the App.tsx file",!1).option("-ct --checkTailwind [boolean]","Check the tailwind.config.js file",!0).option("-cp --checkPnpm [boolean]","Check for Pnpm",!0).action(Ln);K.hook("preAction",async e=>{let t=e.args?.[0],n=e.rawArgs.slice(2),o=n.includes("--no-cache"),r=n.includes("--debug")||n.includes("-d");if(st(o),x.debug=r,x.beta=n.includes("-b")||n.includes("--beta"),t&&wt.includes(t)){let m=(await nt()).components,c=(await nt()).betaComponents;ct({beta:!1,nextUIComponents:m}),x.beta&&ct({beta:!0,nextUIComponents:c});}let[i,a]=await Promise.all([H("cliLatestVersion"),H("latestVersion")]);x.latestVersion=a,x.cliLatestVersion=i;let p=Je.version;E(p,i)===-1&&($e({center:!0,color:"yellow",padding:1,text:`${D.gray(`Available upgrade: v${p} -> ${D.greenBright(`v${i}`)}
Run \`${D.cyan("npm install -g nextui-cli@latest")}\` to upgrade
Changelog: ${D.underline("https://github.com/nextui-org/nextui-cli/releases")}`)}`,title:Ze("NextUI CLI")}),s.newLine());});K.parseAsync(process.argv).catch(async e=>{s.newLine(),s.error("Unexpected error. Please report it as a bug:"),s.log(e),s.newLine(),process.exit(1);});
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map